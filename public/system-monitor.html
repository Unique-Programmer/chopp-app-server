<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>System Monitor Log</title>
    <style>
      body {
        font-family: monospace;
        background: #222;
        color: #eee;
      }
      textarea {
        width: 100%;
        height: 90vh;
        background: #111;
        color: #fff;
      }
      #token {
        width: 60%;
      }
      #auto {
        margin-left: 10px;
      }
    </style>
  </head>
  <body>
    <h2>System Monitor Log</h2>
    <input id="token" type="text" placeholder="JWT Token" />
    <button onclick="loadLog()">Показать лог</button>
    <label id="auto"> <input type="checkbox" id="autoupdate" checked /> Автообновлять </label>
    <br /><br />
    <textarea id="log" readonly></textarea>
    <script>
      let intervalId = null;

      async function loadLog() {
        const token = document.getElementById('token').value;
        if (!token) return;
        const resp = await fetch('/api/system-monitor/log', {
          headers: { Authorization: 'Bearer ' + token },
        });
        document.getElementById('log').value = await resp.text();
      }

      function startAutoUpdate() {
        if (intervalId) clearInterval(intervalId);
        intervalId = setInterval(loadLog, 60000); // каждую минуту
      }

      function stopAutoUpdate() {
        if (intervalId) clearInterval(intervalId);
      }

      document.getElementById('autoupdate').addEventListener('change', function () {
        if (this.checked) {
          startAutoUpdate();
        } else {
          stopAutoUpdate();
        }
      });

      document.getElementById('token').addEventListener('change', function () {
        if (document.getElementById('autoupdate').checked) {
          loadLog();
        }
      });

      if (document.getElementById('autoupdate').checked) {
        startAutoUpdate();
      }
    </script>
  </body>
</html>
